; ************************************************************************************************
; ************************************************************************************************
;
;		Name:		gosub.asm
;		Purpose:	Subroutine call (and return)
;		Created:	1st October 2022
;		Reviewed: 	28th November 2022
;		Author:		Paul Robson (paul@robsons.org.uk)
;
; ************************************************************************************************
; ************************************************************************************************

		.section code

; ************************************************************************************************
;
;											GOSUB command
;
; ************************************************************************************************

Command_GOSUB:	;; [gosub]
		ldx 	#0
		jsr 	Evaluate16BitInteger 		; line number in Stack.0
		lda 	#STK_GOSUB+3 				
		jsr 	StackOpen 					; create frame
		jsr 	STKSaveCodePosition 		; save current position
		jmp 	GotoStackX

; ************************************************************************************************
;
;											RETURN command
;
; ************************************************************************************************

Command_RETURN:	;; [return]
		lda 	#STK_GOSUB 					; check TOS is this
		ldx 	#ERRID_GOSUB 				; this error
		jsr 	StackCheckFrame
		jsr 	STKLoadCodePosition 		; restore code position
		jsr 	StackClose
		rts

		.send code

; ************************************************************************************************
;
;									Changes and Updates
;
; ************************************************************************************************
;
;		Date			Notes
;		==== 			=====
;
; ************************************************************************************************
