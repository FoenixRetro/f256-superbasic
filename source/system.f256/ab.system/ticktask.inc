; ************************************************************************************************
; ************************************************************************************************
;
;		Name:		ticktask.inc
;		Purpose:	Macros for tick-tasks
;		Created:	21st November 2022
;		Reviewed: 	No.
;		Author : 	Paul Robson (paul@robsons.org.uk)
;
; ************************************************************************************************
; ************************************************************************************************

		.if 	HARDWARE==0

; ************************************************************************************************
;
;								This Macro initialises the tick timer
;
; ************************************************************************************************

tickinitialise 	.macro
		.endm		

; ************************************************************************************************
;
;						Called 1 in every 8 instructions, firing each clock
;
; ************************************************************************************************

tickcheck		.macro
		lda 	1 							; save I/O 0
		pha
		stz 	1 							; access I/O Page 0
		sec 								; calculate timer - LastTick
		lda 	$D659
		cmp 	LastTick
		beq 	_NoFireTick 				; if < 3 clocks don't fire.
		sta 	LastTick 					; update last timer
		jsr 	\1 							; go do the code.
_NoFireTick:		
		pla 								; restore I/O 0
		sta 	1
		.endm

		.endif

; ************************************************************************************************
;
;									Changes and Updates
;
; ************************************************************************************************
;
;		Date			Notes
;		==== 			=====
;		01/01/23 		Now fires every tick rather than 1 tick in 3.
;
; ************************************************************************************************
